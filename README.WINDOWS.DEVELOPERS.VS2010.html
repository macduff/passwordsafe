<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Readme For Developers</title>
</head>
<body>

<h1>Developer Notes</h1>

<p>This file contains notes, hints and information of interest for those developers
wishing to compile PasswordSafe for Windows (MFC [Microsoft's Foundation Classes] and
wxWdigets) and Linux (wxWidgets only).  For Windows develpment, this file assumes
that Microsoft's Visual Studio <i>2010</i> (referred to as 'VS2010' below)
and its C++ compiler version 10.0 ('VC10') is being used.</p>

<p>The 'official' build corresponds to the <i>ReleaseM</i> configuration i.e. the release
build using Microsoft's XML parser.  This will build the required DLLs using their
Release configuration (pws_at.dll for AutoType support and pws_osk.dll for the Virtual
Keyboard) and the base resource DLL (pwsafe_base.dll used to create non-English language support).</p>

<p>The current MFC configurations are:</p>

<ul>
<li><b>Debug</b> - builds the debug version of the required DLLs (pws_at_D.dll and pws_osk_D.dll).
This project is automatically selected when any of the debug builds below are selected.</li>
<li><b>DebugE</b> - builds the debug version using the Expat XML parser</li>
<li><b>DebugM</b> - builds the debug version using the Microsoft XML parser</li>
<li><b>DebugX</b> - builds the debug version using the Xerces XML parser</li>
<li><b>Release</b> - builds the release version of the required DLLs (pws_at.dll and pws_osk.dll)
and the resource DLL (pwsafe_base.dll). This project is automatically selected when any 
of the release builds below are selected.</li>
<li><b>ReleaseE</b> - builds the release version using the Expat XML parser</li>
<li><b>ReleaseM</b> - builds the release version using the Microsoft XML parser</li>
<li><b>ReleaseX</b> - builds the release version using the Xerces XML parser</li>
</ul>

<p>The current wxWidgets configurations are:</p>

<ul>
<li><b>Debugwx</b> - builds the debug version without any XML parser</li>
<li><b>DebugwxE</b> - builds the debug version using the Expat XML parser</li>
<li><b>DebugwxX</b> - builds the debug version using the Xerces XML parser</li>
<li><b>Releasewx</b> - builds the release version without any XML parser</li>
<li><b>ReleasewxE</b> - builds the release version using the Expat XML parser</li>
<li><b>ReleasewxX</b> - builds the release version using the Xerces XML parser</li>
</ul>

<p>Note that the corlib and os project files contain <i>all</i> of the above projects,
even if you are only selecting one of the MFC or the wxWidget builds. You should not
have to select them individually as selecting the main PasswordSafe 
configuration will select the correct configuration for these projects.  You should
also be careful not to select all configrations in the VS2010 Batch Build process
either to build, rebuild or clean all configurations.  Only select MFC configurations
if using the MFC PasswordSafe solution (pwsafe100.sln) and the wxWdigets
configurations if using the wxWidgets PasswordSafe solution (pwsafe_wx100.sln).</p>

<h3>Contents</h3>

<ol>
<li><a href="#Software_Requirements">Software Requirements</a></li>
<li><a href="#XML_Processing">XML Processing</a></li>
<li><a href="#Minidump_Production">Minidumps</a></li>
</ol>

<h3><a name="Software_Requirements"></a>Software Requirements</h3>

<h4>Getting Source code</h4>

<p>The source code for PasswordSafe may be downloaded as a zip file, or retrieved
from the Subversion repository at <a href="https://passwordsafe.svn.sourceforge.net/svnroot/passwordsafe/trunk/pwsafe/pwsafe">
https://passwordsafe.svn.sourceforge.net/svnroot/passwordsafe/trunk/pwsafe/pwsafe</a>
using a subversion client. Currently (2010), the Windows version
is built using Microsoft's development tools as described <a href="#Windows_Build">below</a>.
A Linux build is also in early stages of development, as described in the
<a href="#Linux_Build">Linux Build</a> section.</p>

<p>If you're going to commit code to the repository, please set your subversion client's
configuration file as follows:</p>

<p>In the "[miscellany]" section, ensure the following variable is set to 'yes':
<pre>
  enable-auto-props = yes
</pre>
</p>

<p>In the "[auto-props]" section, add the following if not already there:
<pre>
  *.c = svn:eol-style=native
  *.cmd = svn:eol-style=native;svn:mime-type=text/plain
  *.cpp = svn:eol-style=native
  *.cs = svn:eol-style=native
  *.csproj = svn:eol-style=native
  *.dsp = svn:eol-style=CRLF
  *.dsw = svn:eol-style=CRLF
  *.h = svn:eol-style=native
  *.hhc = svn:eol-style=native
  *.hhk = svn:eol-style=native
  *.hpp = svn:eol-style=native
  *.html = svn:eol-style=native;svn:mime-type=text/html
  *.ico = svn:mime-type=image/x-icon
  *.in = svn:eol-style=native
  *.inc = svn:eol-style=native
  *.ini = svn:eol-style=native
  *.iss = svn:eol-style=native
  *.jpg = svn:mime-type=image/jpeg
  *.js = svn:eol-style=native
  *.linux = svn:eol-style=native
  *.manifest = svn:eol-style=CRLF
  *.nsi = svn:eol-style=CRLF
  *.pjd = svn:eol-style=native
  *.pl = svn:eol-style=native
  *.png = svn:mime-type=image/png
  *.po = svn:eol-style=native
  *.rc = svn:eol-style=native
  *.rc2 = svn:eol-style=native
  *.resx = svn:eol-style=native
  *.sh = svn:eol-style=native;svn:executable
  *.sln = svn:eol-style=CRLF
  *.txt = svn:eol-style=native;svn:mime-type=text/plain
  *.vbs = svn:eol-style=native
  *.vcproj = svn:eol-style=CRLF
  *.windows = svn:eol-style=native
  *.wxs = svn:eol-style=native
  *.xml = svn:eol-style=native;svn:mime-type=text/xml
  *.xpm = svn:mime-type=image/x-xpm
  *.xsd = svn:eol-style=native
  *.xsl = svn:eol-style=native
  LICENSE = svn:eol-style=native;svn:mime-type=text/plain
  Makefile = svn:eol-style=native;svn:mime-type=text/plain
  README = svn:eol-style=native;svn:mime-type=text/plain
</pre>
</p>

<p>(This file is ~/.subversion/config for Linux, and under Documents and
Settings\user\Application Data\Subversion\config on Windows.  If using Tortoise
SVN client under Windows, this can be accessed by right clicking a file, selecting 
Tortoise SVN and then select Settings from the menu and using the Edit button in the
General Settings panel).</p>

<h4><a name="Windows_Build"></a>Windows Build</h4>
<p>The Windows version of PasswordSafe can be built using Microsoft Visual Studio
2010 (C++ compiler for PaswordSafe ('VC10') and C# compiler if you wish to re-generate
the Virtual Keyboard data, which is not normally necessary). The VC10 Express compiler
does <u>not</u> support Microsoft's Foundation Classes, which are used extensively
within the current official Windows version.</p>

<p>In order to build the Windows version of PasswordSafe, you need to install
the Microsoft's Windows SDK.  However, it should be automatically installed as part
of the installation of VC10 compiler if you select that you will want to build
Win32 projects.  No other SDK is needed or needs to be installed.  However, you
will need to install the following freely available components, in addition to Visual Studio:</p>
<ul>
<li>To compile and produce the Help files (.chm) then
<a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=00535334-%0D%0Ac8a6-452f-9aa0-d597d16580cc&amp;DisplayLang=en">
Microsoft's HTML Help Workshop</a> is required. Note however that the headers and
libraries necessary for compiling PasswordSafe itself are included in the
Windows SDK mentioned above.</li>
<li>A subversion client, such as <a href="http://tortoisesvn.net/downloads">
Tortoise SVN Client</a> (for updating the revision number within PasswordSafe's
version details)</li>
<li>For XML Support, one or more of the following is needed (see the
<a href="#XML_Processing"> XML processing section</a> for more details):
<ul>
<li>Headers and libraries to support Microsoft's XML V6.0 are included in
the Windows SDK mentioned above and do not need to be installed separately.</li>
<li><a target="_blank" href="http://expat.sourceforge.net/">Expat's V2.0.1
XML Library</a></li>
<li><a target="_blank" href="http://xerces.apache.org/xerces-c/">Xerces
V3.1.1 XML Library</a></li>
</ul>
</li>
</ul>

<h4>Compiling using Visual Studio</h4>

<p>If you're using VS2010, the file "UserVariables.props" <b><u><i>must</i></u></b>
exist and point to the directories where the non-"Windows SDK" components have been
installed. <b><u><i>The solution will not open correctly without this file being
present</i></u></b>. For your convenience, we've included a simple
Visual Basic script, "configure100.vbs", that you can run to generate the
"UserVariables.props" file with the correct values (if you have already used Visual
Studio 2005 or 2008 and have created a "UserVariables.<u>vs</u>props" file,
"configure100.vbs" will use values in this file to generate the default values
when creating the VS2010 equivalent "UserVariables.props". If you are intending
to build the wxWidgets version using VS2010, then you should also copy this
file to the '/src/ui/wxWidgets/' directory.</p>

<h4>wxWidgets</h4>

<p>If you are intending to build the wxWidgets version of PasswordSafe using VC10,
you will need to rebuild the wxWidgets libraries using this compiler.  wxWidgets
(at V2.8.10), as supplied as part of the wxPack package - http://wxpack.sourceforge.net/,
comes with a batch file "wxBuild_wxWidgets.bat" that it places in directory
'build/msw/'.  An updated version that supports VC10 is stored in the PasswordSafe
repository in directory 'Misc/wxWidgets VS2010 Updates/build/msw/'.  It should be
copied into the appropriate wxWidgets directory replacing the supplied batch file,
if present. The file 'Notes.txt' in the same PasswordSafe directory explains how
to run it to produce the necessary wxWidgets libraries.</p>

<h4><a name="Linux_Build"></a>Linux Build</h4>

<p>The Linux version of PasswordSafe is currently in pre-Alpha state. It is
being built under Debian 5.0 (Lenny), and uses uuid-dev and
libwxgtk2.8-dev for building, as well as g++ and GNU make.</p>

<h3><a name="XML_Processing"></a>XML Processing</h3>

<p>Originally, PasswordSafe used only Microsoft's XML library for XML parsing
and validation. For portability, we're now working on support for the
<a href="http://expat.sourceforge.net/" target="_blank">Expat</a>
and <a href="http://xerces.apache.org/xerces-c/" target="_blank">Xerces</a> XML
libraries, which are available for non-Windows platforms. When using VS2010,
we recommend the latest version (currently 3.1.1 as of April 2010), as they
supply pre-built Windows binaries using the VC10 compiler.</p>

<h4><a name="XML_Libraries"></a>XML Libraries</h4>

<p>To determine which XML library to use while building PasswordSafe,
we've defined a pre-processor variable (USE_XML_LIBRARY). If <u>NOT</u>
defined, the compiled PasswordSafe <u>will not process XML files</u>
(databases or filter definitions in XML format). Filters within a database
will be treated as 'Unknown Fields' and will remain unchanged so that
other versions of PasswordSafe that do support XML parsing can still
use them. PasswordSafe would also not be able to import databases exported
to XML. Note, however, that the application will be able to write XML files.</p>

<p>The three valid values of the USE_XML_LIBRARY variable are "EXPAT",
"MSXML" and "XERCES" corresponding to the three different implementations.
For wxWidgets builds, only EXPAT and XERCES will be possible but they are
still under development (as of August 2010).</p>

<p>PasswordSafe uses SAX2 processing for both Microsoft's and the Xerces' XML
Parsers, which are full validating parsers and require the presence of
the appropriate XSD Schema file (included in the distribution and in the
"xml" sub-directory), to process either file or filter imports. This
ensures that the data eventually hitting the SAX2 content handlers is
correct and just needs placing in the appropriate fields.</p>

<p>Expat is a non-validating XML Parser and uses its own API rather than SAX2.
Note: SAX2 is only an official standard for Java XML processing,
although many C supporting parsers also support this interface. Because
Expat is non-validating, significant extra code has been added directly into
PasswordSafe to perform this validation, so that the program and its 
databases are not corrupted by poorly formed XML or incorrect data within
the XML file.</p>

<p>Expat is no longer under very active development.  The current version (2.0.1)
was released in June 2007.  The Windows binaries from their web site are only
build using VS2005 (the VC8 compiler).  If you intend to use Expat in a VS2010
build (either the standard MFC build or the wxWidgets build), you will need to
recompile Expat using the VC10 compiler.  The necessary VC10 project files have
been uploaded to the PasswordSafe repository.  They can be found under the
'/misc/Expat VS2010 Poject Files/' directory.  The directory structure corresponds to the
Expat Windows directory structure created when installing Expat from their download.
Note: The building of Expat using VC10, creates the new libraries and DLLs in a 
directories 'Source/win32/Bin10/Debug' and '/Source/win32/Bin10/Release'. The Bin10
directory should be copied to the same directory contining the VC8 builds (Bin). The
distributed Expat only supplies the VC8 release builds.  PasswordSafe projects
using Expat will use the corresponding debug or release versions depending on the
version you are building.</p>

<h3><a name="Minidump_Production"></a>Minidump Production (Windows MFC build only)</h3>

<p>In order to help debug user problems when Windows just says "there has
been an error", a "Windows Unhandled Fault Handler" has been added. This will
create a minidump, which can then be used to find where the error took
place and, hopefully, why.</p>

<p>An extra "extended" Command Line flag of "--testdump" has been introduced
for two reasons. Firstly, it allows the developer to test the minidump process,
which is only available in the Release version of the executable and,
secondly, allows the translators to check that the error screen displays
as they wish.</p>

<p><u>Note to Translators:</u> the error screen is a basic Windows function
and has a fixed width. This is the reason why the minidump file name and
directory have been split onto separate lines.</p>

<p><u>Note: Extended flags start with two minus signs ('--') and must be
specified in full - i.e. no abbreviations. They are not displayed in the
Usage notes for the normal users and no error message or display is shown
if they are not recognised.</u></p>

<p>With this flag set, there will appear an extra button in the bottom right
hand corner of the "About PasswordSafe" dialog. Click it, and a minidump
should be produced.</p>

<p>In order to process the minidump, either the free Microsoft Windbg
program can be used (see Microsoft's site for details), or Visual Studio
(VS) can be used. In the latter case (and probably the former too!):</p>
<ol>
<li>You need the source corresponding to the failing release
version. This should be available from SourceForge web site either in
the normal Download section or from the Subversion repository, based on
the revision number associated with that release. Without the
corresponding source, VS can only show Windows source and line numbers in
PasswordSafe source. With the corresponding source, VS can show you the
exact line in PasswordSafe where the error took place and also the other
statements within PasswordSafe as you follow the stack trace.</li>
<li>You need the Program Debug Database (pwsafe.pdb) associated with the
failing release. This is not normally uploaded to the SourceForge web
site with the release package. It is large (~11.5MB or ~3MB
compressed). Since this must correspond to the PasswordSafe executable that
had the error, maybe this and, possibly, the associated Link Map can be
uploaded to a Developers section on this web site to aid all developers.</li>
<li>You should probably maintain the directory structure of the project
as described in the source downloaded from SourceForge and place the
Program Debug Database file in the '..\src\bin\releasem' directory.</li>
<li>Save the user's minidump file on your PC. Use VS to Open this <u>as
a Project</u> (e.g. File-&gt;Open-&gt;Project/Solution).</li>
<li>In the Debugging Options, specify the directory containing the corresponding
PDB file. (Go to: Tools-&gt;Options-&gt;Debugging-&gt;Symbols and add
this directory in the section entitled "Symbol file (.pdb)
locations:").</li>
<li>Press F5 to start debugging, and away you go.</li>
</ol>

<p><b>*** End of Developer Notes ***</b></p>

<br>
<br>
<br>
</body>
</html>
